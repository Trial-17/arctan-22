"object"!=typeof JSON&&(JSON={}),function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta,rep;function f(e){return e<10?"0"+e:e}function this_value(){return this.valueOf()}function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,a,s,o,r,i=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)r[n]=str(n,c)||"null";return s=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+i+"]":"["+r.join(",")+"]",gap=i,s}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&(s=str(a=rep[n],c))&&r.push(quote(a)+(gap?": ":":")+s);else for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(s=str(a,c))&&r.push(quote(a)+(gap?": ":":")+s);return s=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+i+"}":"{"+r.join(",")+"}",gap=i,s}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value),"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var a;if(gap="",indent="","number"==typeof n)for(a=0;a<n;a+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var n,a,s=e[t];if(s&&"object"==typeof s)for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(void 0!==(a=walk(s,n))?s[n]=a:delete s[n]);return reviver.call(e,t,s)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();let isLoggedIn=!1,authToken=null,userData={username:"",email:"",membershipStatus:""};const API_URL="https://api.premierecopilot.com/api",CURRENT_VERSION="1.6.0",TOKEN_KEY="premiereCopilot_token",USER_EMAIL_KEY="premiereCopilot_email",USER_PASSWORD_KEY="premiereCopilot_password";async function initAuth(){const e=localStorage.getItem(TOKEN_KEY),t=localStorage.getItem(USER_EMAIL_KEY),n=localStorage.getItem(USER_PASSWORD_KEY);if(e)try{authToken=e;const t=await getUserInfo();if(t)return setLoggedIn(t),!0}catch(e){console.error("Token invalide ou expiré:",e),clearAuthData()}if(t&&n)try{return await loginUser(t,n)}catch(e){console.error("Échec de la reconnexion automatique:",e),clearAuthData()}return showAuthModal(!0),!1}function initAuthEvents(){document.getElementById("userButton").addEventListener("click",function(){isLoggedIn?showUserModal():showAuthModal()}),document.getElementById("authModal").addEventListener("click",function(e){e.target!==this||this.classList.contains("forced")||(this.style.display="none")}),document.getElementById("userModal").addEventListener("click",function(e){e.target===this&&(this.style.display="none")}),document.getElementById("signInButton").addEventListener("click",async function(){const e=document.getElementById("authEmail").value,t=document.getElementById("authPassword").value;if(e&&t)try{const n=this.querySelector("span"),a=n.textContent;n.textContent="Connexion...",this.disabled=!0;await loginUser(e,t)||(alert("Email or password incorrect"),n.textContent=a,this.disabled=!1)}catch(e){alert("Error during connection: "+e.message),this.disabled=!1}else alert("Veuillez saisir votre email et mot de passe")}),document.getElementById("signUpLink").addEventListener("click",function(e){e.preventDefault(),(new CSInterface).openURLInDefaultBrowser("https://premierecopilot.com/sign-up")}),document.getElementById("logoutButton").addEventListener("click",function(){logoutUser()}),document.getElementById("documentationButton").addEventListener("click",function(){(new CSInterface).openURLInDefaultBrowser("https://louisbolzinger.notion.site/Documentation-20ed6f2e5f49806f82c3cb70899ea94a?source=copy_link")}),document.getElementById("featureRequestButton").addEventListener("click",function(){(new CSInterface).openURLInDefaultBrowser("https://louisbolzinger.notion.site/208d6f2e5f4980738f23ca70f949e0f6")}),document.getElementById("updateNowButton").addEventListener("click",()=>{(new CSInterface).openURLInDefaultBrowser("https://www.premierecopilot.com/download"),document.getElementById("updateModal").style.display="none"}),document.getElementById("updateLaterButton").addEventListener("click",()=>{document.getElementById("updateModal").style.display="none"})}async function checkAppVersion(){try{const e=await fetch(`${API_URL}/version`);if(!e.ok)return void console.error("Could not retrieve version from server.");const t=await e.json(),n=t.version,a=t.features;n!==CURRENT_VERSION&&showUpdateModal(a)}catch(e){console.error("Error when checking version:",e)}}function showUpdateModal(e){const t=document.getElementById("updateFeaturesList");t.innerHTML="",e.forEach(e=>{const n=document.createElement("li");n.textContent=e,t.appendChild(n)}),document.getElementById("updateModal").style.display="flex"}function showAuthModal(e=!1){const t=document.getElementById("authModal");resetLoginForm(),t.style.display="flex",e?t.classList.add("forced"):t.classList.remove("forced")}function showUserModal(){const e=document.getElementById("userModal");document.getElementById("userModalName").textContent=userData.username;const t=document.getElementById("membershipStatus");t.textContent=userData.membershipStatus,t.className="membershipBadge";const n=getMembershipClass(userData.membershipStatus);t.classList.add(n),e.style.display="flex"}async function loginUser(e,t){try{const n=new URLSearchParams;n.append("username",e),n.append("password",t);const a=await fetch(`${API_URL}/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.detail||"Échec de la connexion")}const s=await a.json();authToken=s.access_token,localStorage.setItem(TOKEN_KEY,authToken),localStorage.setItem(USER_EMAIL_KEY,e),localStorage.setItem(USER_PASSWORD_KEY,t);const o=await getUserInfo();return!!o&&(setLoggedIn(o),!0)}catch(e){return console.error("Erreur de connexion:",e),!1}}async function getUserInfo(){if(!authToken)return null;try{const e=await fetch(`${API_URL}/users/me/`,{method:"GET",headers:{Authorization:`Bearer ${authToken}`}});if(!e.ok)throw new Error("Échec de récupération des informations utilisateur");const t=await e.json();return console.log("Informations utilisateur récupérées:",t),t}catch(e){return console.error("Erreur lors de la récupération des informations utilisateur:",e),clearAuthData(),logoutUser(),null}}async function getSubscriptionInfo(){if(!authToken)return null;try{const e=await fetch(`${API_URL}/subscription/info`,{method:"GET",headers:{Authorization:`Bearer ${authToken}`}});if(!e.ok)throw new Error("Échec de récupération des informations d'abonnement");return await e.json()}catch(e){return console.error("Erreur lors de la récupération des informations d'abonnement:",e),null}}function setLoggedIn(e){isLoggedIn=!0,userData={username:`${e.firstname} ${e.name}`,email:e.email,membershipStatus:getMembershipName(e.membership)},console.log("Utilisateur connecté:",userData),document.getElementById("authModal").style.display="none",document.getElementById("authModal").classList.remove("forced"),updateUIForLoggedInUser(),updateUserCredits(),checkAppVersion()}function getMembershipName(e){return{0:"Free",1:"Pro",2:"Creator",3:"Enterprise",4:"Podcast"}[e]||"Gratuit"}function getMembershipClass(e){return{Gratuit:"free",Pro:"starter",Podcast:"starter",Creator:"pro",Enterprise:"enterprise"}[e]||"free"}function logoutUser(){isLoggedIn=!1,authToken=null,userData={username:"",email:"",membershipStatus:""},clearAuthData(),document.getElementById("userModal").style.display="none",resetLoginForm(),showAuthModal(!0),updateUIForLoggedOutUser()}function resetLoginForm(){document.getElementById("authEmail").value="",document.getElementById("authPassword").value="";const e=document.getElementById("signInButton");e.disabled=!1;const t=e.querySelector("span");t&&(t.textContent="Sign In");const n=document.getElementById("statusMessage");n&&(n.style.display="none",n.className="statusMessage",n.textContent=""),document.getElementById("authEmail").classList.remove("inputError"),document.getElementById("authPassword").classList.remove("inputError")}function clearAuthData(){localStorage.removeItem(TOKEN_KEY),localStorage.removeItem(USER_EMAIL_KEY),localStorage.removeItem(USER_PASSWORD_KEY)}function updateUIForLoggedInUser(){}function updateUIForLoggedOutUser(){}function getAuthToken(){return authToken}function isUserLoggedIn(){return isLoggedIn}function hasRequiredMembership(e){if(!isLoggedIn||!userData)return!1;return({Free:0,Pro:1,Creator:2,Enterprise:3,Podcast:4}[userData.membershipStatus]||0)>=e}async function updateUserCredits(){if(authToken)try{const e=await fetch(`${API_URL}/user/credits`,{method:"GET",headers:{Authorization:`Bearer ${authToken}`}});if(!e.ok)throw new Error("Erreur lors de la récupération des crédits");const t=await e.json(),n=document.getElementById("researchCreditValue");n&&(n.textContent=t.credits_Labelization);const a=document.getElementById("imageGenerationCreditValue");a&&(a.textContent=t.credits_Generation),console.log("Crédits utilisateur mis à jour:",t)}catch(e){console.error("Erreur lors de la mise à jour des crédits:",e)}}function runExtendScript(e){var t=new CSInterface;return new Promise((n,a)=>{t.evalScript(e,function(e){null!=e?n(e):a("Erreur : Nombre de pistes non récupéré")})})}function runPythonScript_V2(e,t=[]){const n=require("path"),{execFileSync:a}=require("child_process");try{const s=n.join(__dirname,"js","libs","miniconda3","envs","api_env"),o=n.join(s,"bin","python");return a(o,[e,...t],{encoding:"utf-8",stdio:["ignore","pipe","ignore"],env:{...process.env,PATH:n.join(s,"bin")+":"+process.env.PATH,CONDA_PREFIX:s,PYTHONPATH:n.join(s,"lib","python3.12","site-packages")}})}catch(e){throw new Error(`❌ Erreur d'exécution: ${e.message}`)}}function runRawExtendScriptCode(e){var t=new CSInterface;return new Promise((n,a)=>{t.evalScript(e,function(e){null!=e?n(e):alert("Erreur : Script ExtendScript échoué")})})}function updateStatusMessage(e){const t=document.getElementById("statusMessage"),n=document.getElementById("loadingIndicator");document.getElementById("sendButton");"End"===e?(n.style.display="none",t.style.display="none",t.textContent=""):(n.style.display="flex",t.style.display="block",t.textContent=e)}async function startPodcastEditing(e){try{updateStatusMessage("Backup"),await runExtendScript("$._MYFUNCTIONS.backupActiveSequence()"),updateStatusMessage("Exporting Tracks");const t=await runExtendScript("$._MYFUNCTIONS.exportAudioTracksDirect()"),n=JSON.parse(t);let a;if(updateStatusMessage("Analyzing active speaker"),a=window.auth&&"function"==typeof window.auth.getAuthToken?window.auth.getAuthToken():localStorage.getItem("premiereCopilot_token"),!a)return void updateStatusMessage("Authentification error");if(!(await fetch("http://127.0.0.1:8000/podcast",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paths:n,front_data:e,token:a})})).ok)return void updateStatusMessage("Error starting podcast analysis");let s=!1,o=null;for(;!s;){await new Promise(e=>setTimeout(e,500));const e=await fetch("http://127.0.0.1:8000/podcast-results"),t=await e.json();t.error?updateStatusMessage("Analyzing active speaker"):(updateStatusMessage("Podcast analysis complete!"),o=t,s=!0)}updateStatusMessage("Auto Cut"),"standard"===e.global.cuttingMethod?(await runExtendScript("$._MYFUNCTIONS.perform_cut('"+JSON.stringify(o)+"')"),await runExtendScript("$._MYFUNCTIONS.supprimerClipsDesactives_PODCAST()")):await runExtendScript("$._MYFUNCTIONS.perform_cut('"+JSON.stringify(o)+"')")}catch(e){updateStatusMessage("An error occurred: "+e.message)}finally{updateStatusMessage("End")}}async function getJumpCutPreview(e){let t,n;if(t=window.auth&&"function"==typeof window.auth.getAuthToken?window.auth.getAuthToken():localStorage.getItem("premiereCopilot_token"),!t)return alert("Please log in to access this feature."),null;try{updateStatusMessage("Exporting audio"),n=await runExtendScript("$._MYFUNCTIONS.exportAudioJumpCuts()");const a=await runExtendScript("$._MYFUNCTIONS.getOffsetJumpCuts()"),s={silence_cutoff:e.silenceCutoff,remove_silences_over:e.removeSilencesOver,keep_segments_over:e.keepSegmentsOver,padding:e.padding,offset:a,audio_path:n,token:t,preview:!0};updateStatusMessage("Creating preview");const o=await fetch("http://127.0.0.1:8000/jump-cut-preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return updateStatusMessage("End"),await o.json()}catch(e){return alert("Error fetching jump cut preview:",e),null}finally{if(n)try{await runExtendScript(`$._MYFUNCTIONS.deleteFile('${n}')`),console.log("Temporary audio file deleted:",n)}catch(e){console.error("Error deleting temporary file:",e)}}}async function createJumpCutsAnalysis(e){let t,n;if(t=window.auth&&"function"==typeof window.auth.getAuthToken?window.auth.getAuthToken():localStorage.getItem("premiereCopilot_token"),!t)return alert("Authentication error: Please log in."),null;try{updateStatusMessage("Backup"),await runExtendScript("$._MYFUNCTIONS.backupActiveSequence()"),updateStatusMessage("Exporting audio"),n=await runExtendScript("$._MYFUNCTIONS.exportAudioJumpCuts()");const a={silence_cutoff:e.silenceCutoff,remove_silences_over:e.removeSilencesOver,keep_segments_over:e.keepSegmentsOver,padding:e.padding,offset:0,audio_path:n,token:t,preview:!1};updateStatusMessage("Running analysis");const s=await fetch("http://127.0.0.1:8000/jump-cut-preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return(await s.json()).time_segments}catch(e){return alert("Error creating jump cut analysis:",e),null}finally{if(n)try{await runExtendScript(`$._MYFUNCTIONS.deleteFile('${n}')`),console.log("Temporary audio file deleted:",n)}catch(e){console.error("Error deleting temporary file:",e)}}}async function generateImage(e,t,n){let a;if(n={"21:9":"1584:672","9:16":"720:1280","16:9":"1280:720","1:1":"832:1104","1:1":"960:960"}[n]||n,a=window.auth&&"function"==typeof window.auth.getAuthToken?window.auth.getAuthToken():localStorage.getItem("premiereCopilot_token"),!a)return alert("Erreur d'authentification: Veuillez vous connecter."),null;updateStatusMessage("Generating Image");const s=await fetch("http://127.0.0.1:8000/generate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,image_path:t||"",token:a,aspect:n})}),o=await s.json();return await runExtendScript("$._MYFUNCTIONS.importImageToImageGenerationBin_V2("+JSON.stringify(o.image_path)+")"),updateStatusMessage("End"),o.image_path}async function generateVideo(e){let t;if(t=window.auth&&"function"==typeof window.auth.getAuthToken?window.auth.getAuthToken():localStorage.getItem("premiereCopilot_token"),!t)return alert("Erreur d'authentification: Veuillez vous connecter."),null;const n=e.startFramePath,a=e.aspectRatio,s=e.type,o=e.prompt;updateStatusMessage("Running");try{const e=await fetch("http://127.0.0.1:8000/generate-video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,image_path:n,prompt:o,ratio:a,type:s})});if(!e.ok)throw new Error("Erreur API : "+e.status);const r=await e.json();return updateStatusMessage("End"),r}catch(e){return alert("❌ Erreur lors de la génération de vidéo : "+e.message),updateStatusMessage("Erreur"),null}}async function autoFill(){var e=await runExtendScript("$._MYFUNCTIONS.exportCurrentFrameToHighResPNG()");let t;if(t=window.auth&&"function"==typeof window.auth.getAuthToken?window.auth.getAuthToken():localStorage.getItem("premiereCopilot_token"),!t)return alert("Authentification failed"),null;const n=document.getElementById("messageInput").value.trim();let a=null;updateStatusMessage("Running");try{const s=await fetch("http://127.0.0.1:8000/flux-fill",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,image_path:e,prompt:n})});if(!s.ok)throw new Error("Erreur API : "+s.status);a=await s.json(),updateStatusMessage("End")}catch(e){return alert("❌ Error during Flux Fill Generation: "+e.message),updateStatusMessage("Erreur"),null}await runExtendScript("$._MYFUNCTIONS.importImageToImageGenerationBin_V2("+JSON.stringify(a)+")")}async function analyse_auto_edit(e){try{var t=await runExtendScript("$._MYFUNCTIONS.getRushPathsFromBin('"+e+"')");const n=JSON.parse(t);updateStatusMessage("Rush Analysis");const a=window.auth.getAuthToken();fetch("http://127.0.0.1:8000/labelize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paths:n,token:a})});let s=!1;for(;!s;){await new Promise(e=>setTimeout(e,500));const e=await fetch("http://127.0.0.1:8000/status"),t=(await e.json()).status;updateStatusMessage(t),"end"===t.toLowerCase()&&(s=!0)}return loadRushDatabase(),updateStatusMessage("End"),await window.auth.updateUserCredits(),n}catch(e){alert("❌ Erreur pendant l'analyse : "+e.message)}}async function audio_analysis(){updateStatusMessage("Audio export");const e=window.auth.getAuthToken(),t=document.querySelectorAll(".autoEdit_select")[1].value,n=document.getElementById("messageInput").value.trim(),a=document.getElementById("modeleChoice").value;if("music"==t){const e=await runExtendScript("$._MYFUNCTIONS.exportFullAudioFromSequence()");updateStatusMessage("Audio Analysis"),fetch("http://127.0.0.1:8000/music-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audio_path:e,modele_choice:a})});let t=!1;for(;!t;){await new Promise(e=>setTimeout(e,500));const e=await fetch("http://127.0.0.1:8000/status"),n=await e.json();updateStatusMessage(n.status),"end"===n.status.toLowerCase()&&(t=!0)}const n=await fetch("http://127.0.0.1:8000/audio-results"),s=await n.json(),{downbeats:o,beats:r,demixed_path:i,path_analysis:c}=s;return await runExtendScript("$._MYFUNCTIONS.apply_music_analysis('"+i+"', "+JSON.stringify(r)+", "+JSON.stringify(o)+")"),updateStatusMessage("End"),{downbeats:o,beats:r,demixed_path:i,path_analysis:c,exportAudio:e}}if("speaker"==t){const t=await runExtendScript("$._MYFUNCTIONS.exportFullAudioFromSequence()");updateStatusMessage("Speaker Analysis"),fetch("http://127.0.0.1:8000/speaker-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audio_path:t,prompt:n,token:e,modele_choice:a})});let s=!1;for(;!s;){await new Promise(e=>setTimeout(e,500));const e=await fetch("http://127.0.0.1:8000/status"),t=await e.json();updateStatusMessage(t.status),"end"===t.status.toLowerCase()&&(s=!0)}const o=await fetch("http://127.0.0.1:8000/audio-results"),r=await o.json(),i=r[0],c=r[1],l=r[2];return await runExtendScript("$._MYFUNCTIONS.perform_cut_transcription("+JSON.stringify(l)+")"),await runExtendScript("$._MYFUNCTIONS.importSRTAsCaption("+JSON.stringify(i)+")"),updateStatusMessage("End"),{srt_path:i,srt_path_A:c,cuts:l}}}async function fast_edit(){updateStatusMessage("Back Up"),await runExtendScript("$._MYFUNCTIONS.backupActiveSequence()"),updateStatusMessage("Fast Edit"),await runExtendScript("$._MYFUNCTIONS.fast_edit()"),updateStatusMessage("End")}async function auto_edit(){updateStatusMessage("Back Up"),await runExtendScript("$._MYFUNCTIONS.backupActiveSequence()");const e=window.auth.getAuthToken(),t=document.getElementById("folderName").value,n=document.querySelectorAll(".autoEdit_select"),a=n[0].value,s=n[1].value,o=document.getElementById("messageInput").value.trim(),r=document.getElementById("modeleChoice").value,i=await audio_analysis();var c=await analyse_auto_edit(t);if("music"==s){fetch("http://127.0.0.1:8000/auto-edit-music",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:o,rush_paths:c,analysis_path:i.path_analysis,audio_path:i.exportAudio,chronologic_type:a,token:e,modele_choice:r})});let t=!1;for(;!t;){await new Promise(e=>setTimeout(e,500));const e=await fetch("http://127.0.0.1:8000/status"),n=(await e.json()).status;updateStatusMessage(n),"end"===n.toLowerCase()&&(t=!0)}const n=await fetch("http://127.0.0.1:8000/auto-edit-results"),s=await n.json();updateStatusMessage("Adding clips to timeline"),await runExtendScript("$._MYFUNCTIONS.insertClipsFromData("+JSON.stringify(s)+")"),updateStatusMessage("End")}else if("speaker"==s){fetch("http://127.0.0.1:8000/auto-edit-speaker",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:o,rush_paths:c,srt_path:i.srt_path_A,chronologic_type:a,token:e,modele_choice:r})});let t=!1;for(;!t;){await new Promise(e=>setTimeout(e,500));const e=await fetch("http://127.0.0.1:8000/status"),n=(await e.json()).status;updateStatusMessage(n),"end"===n.toLowerCase()&&(t=!0)}const n=await fetch("http://127.0.0.1:8000/auto-edit-results"),s=await n.json();updateStatusMessage("Adding clips to timeline"),await runExtendScript("$._MYFUNCTIONS.insertClipsFromData_SPEAKER("+JSON.stringify(s)+")"),updateStatusMessage("End")}return"Done"}async function Pipeline(e,t){updateStatusMessage("Back Up"),await runExtendScript("$._MYFUNCTIONS.backupActiveSequence()"),updateStatusMessage("Reasoning");try{if(window.auth){if(!window.auth.isUserLoggedIn())return updateStatusMessage("End"),"You are not logged in. Please log in to use this feature.";if(!window.auth.hasRequiredMembership(1))return updateStatusMessage("End"),"You do not have the required membership to use this feature.";const n=window.auth.getAuthToken();if(!n)return updateStatusMessage("End"),"Error: auth failed";const a=await fetch("http://127.0.0.1:8000/premiere-copilot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,id_prompt:t,top_k:2,token:n})});a.ok||(alert("Failed to fetch"),updateStatusMessage("End"));const{code:s,answer:o}=await a.json();return"AUDIO_SYNC"===s?"Audio Sync feature not available in beta.":"AUDIO_RESEARCH"===s?(updateStatusMessage("Audio Research"),await audioResearch()):(updateStatusMessage("Performing Action"),await runRawExtendScriptCode(s),updateStatusMessage("End"),o)}return updateStatusMessage("End"),"Error: auth failed"}catch(e){return updateStatusMessage("End"),`Sorry, and error just occured: ${e.message}`}}async function audioResearch(){updateStatusMessage("Audio export");const e=window.auth.getAuthToken(),t=document.getElementById("messageInput").value.trim(),n=await runExtendScript("$._MYFUNCTIONS.exportFullAudioFromSequence()");updateStatusMessage("Audio Research");const a=await fetch("http://127.0.0.1:8000/audio-research",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audio_path:n,prompt:t,token:e})}),s=await a.json();return await runExtendScript("$._MYFUNCTIONS.addMarkersFromAnnotations("+JSON.stringify(s)+")"),"Audio Research completed successfully. Annotations have been added to the timeline."}function resetPodcastAnimations(){const e=document.querySelector("#podcastInterface .podcast_boxWrapper:first-child"),t=document.querySelector("#podcastInterface .podcast_boxWrapper:last-child"),n=document.querySelector("#advancedCutSettings"),a=document.querySelector("#speakersParameters"),s=document.querySelector("#camerasParameters"),o=document.querySelector(".podcast_presetRow"),r=document.querySelectorAll("#podcastInterface .podcast_inputGroup"),i=[e,t,n,a,s,o,...r];i.forEach(e=>{e&&(e.style.animation="none")}),i.forEach(e=>{e&&e.offsetWidth}),e&&(e.style.animation="fadeInLeft 0.3s ease-out forwards"),t&&(t.style.animation="fadeInRight 0.3s ease-out forwards",t.style.animationDelay="0.1s",t.style.opacity="0"),o&&(o.style.animation="fadeInScale 0.25s ease-out forwards",o.style.animationDelay="0.2s",o.style.opacity="0"),n&&(n.style.animation="fadeInUp 0.3s ease-out forwards",n.style.animationDelay="0.2s",n.style.opacity="0"),a&&(a.style.animation="fadeInUp 0.3s ease-out forwards",a.style.animationDelay="0.3s",a.style.opacity="0"),s&&(s.style.animation="fadeInUp 0.3s ease-out forwards",s.style.animationDelay="0.4s",s.style.opacity="0"),r.forEach((e,t)=>{e.style.animation="fadeInScale 0.25s ease-out forwards",e.style.animationDelay=.25+.05*t+"s",e.style.opacity="0"});const c=document.querySelectorAll(".speakerRow"),l=document.querySelectorAll(".cameraRow");c.forEach((e,t)=>{e.style.animation="none",e.offsetWidth,e.style.animation="fadeInScale 0.25s ease-out forwards",e.style.animationDelay=.4+.05*t+"s",e.style.opacity="0"}),l.forEach((e,t)=>{e.style.animation="none",e.offsetWidth,e.style.animation="fadeInScale 0.25s ease-out forwards",e.style.animationDelay=.5+.05*t+"s",e.style.opacity="0"})}function validateCutTimes(){const e=parseInt(document.getElementById("minCutTime").value);e>=parseInt(document.getElementById("maxCutTime").value)&&(document.getElementById("maxCutTime").value=e+1)}function initSliders(){setupSlider("delayCutsSlider","delayCutsValue"),setupSlider("ignoreCutSlider","ignoreCutValue")}function setupSlider(e,t){const n=document.getElementById(e),a=document.getElementById(t);n&&a&&(n.addEventListener("input",()=>{a.value=parseFloat(n.value).toFixed(2)}),a.addEventListener("change",()=>{let e=parseFloat(a.value);const t=parseFloat(n.min),s=parseFloat(n.max);isNaN(e)&&(e=t),e<t&&(e=t),e>s&&(e=s),a.value=e.toFixed(2),n.value=e}),document.querySelectorAll(`.stepper-button[data-for="${t}"]`).forEach(e=>{e.addEventListener("click",()=>{const t=parseFloat(e.dataset.step);let s=parseFloat(a.value);s+=t;const o=parseFloat(n.min),r=parseFloat(n.max);s<o&&(s=o),s>r&&(s=r),a.value=s.toFixed(2),n.value=s})}))}function initDynamicSections(){const e=document.getElementById("speakerCount"),t=document.getElementById("cameraCount");e.addEventListener("change",updateSpeakersSection),t.addEventListener("change",updateCamerasSection),updateSpeakersSection(),updateCamerasSection()}function updateSpeakersSection(){const e=parseInt(document.getElementById("speakerCount").value),t=document.getElementById("speakersParameters");if(!t)return;t.innerHTML="";const n=document.createElement("h3");n.className="panel-param-title has-tooltip",n.innerHTML='\n        <img src="assets/speakerscamerasparameters.png" class="panel-title-icon-img" alt="Parameters Icon">\n        <span>AudioTracks Parameters</span>\n        <span class="info-tooltip info-tooltip-top">\n            <span class="tooltip-icon">i</span>\n            Assign each speaker to their corresponding audio track. The name can be customized for easier identification.\n        </span>\n    ',t.appendChild(n);const a=document.createElement("div");t.appendChild(a),t.style.minHeight=`${Math.max(100,50+50*e)}px`;for(let t=1;t<=e;t++){const n=document.createElement("div");n.className="speakerRow",n.style.opacity="0",n.style.animation="fadeInScale 0.25s ease-out forwards",n.style.animationDelay=.35+.05*(t-1)+"s";const s=`\n            <input type="text" class="speakerNameInput speaker-color-${t}" value="Speaker ${t}" data-speaker-id="${t}">\n            <select class="unified-select audioTrackSelect">\n                ${generateTrackOptions(e,t)}\n            </select>`;n.innerHTML=s,a.appendChild(n)}document.querySelectorAll(".speakerNameInput").forEach(e=>{e.addEventListener("input",updateSpeakerNamesInCameraSection)}),updateSpeakerNamesInCameraSection(),intelligentSpeakerAssignment()}function generateTrackOptions(e,t){let n="";for(let a=1;a<=e;a++)n+=`<option value="${a}" ${a===t?"selected":""}>Track ${a}</option>`;return n}function updateCamerasSection(){const e=parseInt(document.getElementById("cameraCount").value),t=document.getElementById("camerasParameters");if(!t)return;t.innerHTML="";const n=document.createElement("h3");n.className="panel-param-title has-tooltip",n.innerHTML='\n        <img src="assets/speakerscamerasparameters.png" class="panel-title-icon-img" alt="Parameters Icon">\n        <span>VideoTracks Parameters</span>\n        <span class="info-tooltip info-tooltip-top">\n            <span class="tooltip-icon">i</span>\n            Configure each video track, assign speakers to it, and set the frequency of cuts for that camera angle.\n        </span>\n    ',t.appendChild(n);const a=document.createElement("div");t.appendChild(a),t.style.minHeight=`${Math.max(100,50+50*e)}px`;for(let t=1;t<=e;t++){const e=document.createElement("div");e.className="cameraRow",e.style.opacity="0",e.style.animation="fadeInScale 0.25s ease-out forwards",e.style.animationDelay=.35+.05*(t-1)+"s",e.innerHTML=`\n            <div class="cameraTitle">VideoTrack ${t}</div>\n            <select class="unified-select frequencySelect">\n                <option value="Very Low">Very Low Frequency</option>\n                <option value="Low">Low Frequency</option>\n                <option value="Medium" selected>Medium Frequency</option>\n                <option value="High">High Frequency</option>\n            </select>\n            <div class="multiSelect">\n                <div class="multiSelectHeader" data-camera="${t}">\n                    <span class="placeholder">Select speakers...</span>\n                </div>\n                <div class="multiSelectDropdown"></div>\n            </div>\n        `,updateCameraSpeakerOptions(e),a.appendChild(e)}setupMultiSelectEvents(),intelligentSpeakerAssignment()}function updateSpeakerNamesInCameraSection(){document.querySelectorAll(".cameraRow").forEach(e=>{updateCameraSpeakerOptions(e)}),setupMultiSelectEvents()}function updateCameraSpeakerOptions(e){const t=e.querySelector(".multiSelectDropdown"),n=e.querySelector(".multiSelectHeader"),a=Array.from(n.querySelectorAll(".selectedSpeaker")).map(e=>e.dataset.speakerId);t.innerHTML="";document.querySelectorAll(".speakerNameInput").forEach(e=>{const n=e.dataset.speakerId,s=e.value,o=document.createElement("div");o.className="speakerOption",o.setAttribute("data-speaker",n),a.includes(n)&&o.classList.add("selected"),o.innerHTML=`\n            <span class="speakerColorDot speaker-color-${n}"></span>\n            <span>${s}</span>\n        `,t.appendChild(o)}),n.innerHTML="",a.forEach(e=>{const t=document.querySelector(`.speakerNameInput[data-speaker-id="${e}"]`);if(t){const a=t.value,s=document.createElement("div");s.className=`selectedSpeaker speaker-color-${e}`,s.setAttribute("data-speaker-id",e),s.innerHTML=`\n                ${a}\n                <button class="removeButton" onclick="event.stopPropagation(); removeSpeakerTag(this);">×</button>\n            `,n.appendChild(s)}}),0===n.children.length&&(n.innerHTML='<span class="placeholder">Select speakers...</span>')}function setupMultiSelectEvents(){document.removeEventListener("click",handleOutsideClick),document.addEventListener("click",handleOutsideClick);const e=document.querySelectorAll(".multiSelectHeader"),t=document.querySelectorAll(".speakerOption");e.forEach(e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",function(e){e.stopPropagation();const t=this.nextElementSibling,n=this.closest(".cameraRow"),a=t.classList.contains("show");if(document.querySelectorAll(".cameraRow").forEach(e=>{e.style.zIndex="1"}),document.querySelectorAll(".multiSelectDropdown.show").forEach(e=>{e!==t&&e.classList.remove("show")}),a)t.classList.remove("show");else{n&&(n.style.zIndex="10"),t.style.zIndex="1001",t.classList.add("show");const e=t.getBoundingClientRect(),a=window.innerHeight;e.bottom>a?(t.style.top="auto",t.style.bottom="100%",t.style.marginTop="0",t.style.marginBottom="5px"):(t.style.top="100%",t.style.bottom="auto",t.style.marginTop="5px",t.style.marginBottom="0")}})}),t.forEach(e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",function(e){e.stopPropagation();this.getAttribute("data-speaker");updateSelectedSpeakers(this.closest(".multiSelect").querySelector(".multiSelectHeader"),this,this.classList.toggle("selected"))})})}function removeSpeakerTag(e){const t=e.parentElement,n=t.parentElement,a=t.dataset.speakerId,s=n.closest(".multiSelect").querySelector(".multiSelectDropdown").querySelector(`.speakerOption[data-speaker="${a}"]`);s&&s.classList.remove("selected"),t.remove(),updateHeaderState(n)}function handleOutsideClick(e){e.target.closest(".multiSelect")||(document.querySelectorAll(".multiSelectDropdown.show").forEach(e=>{e.classList.remove("show");const t=e.closest(".cameraRow");t&&(t.style.zIndex="1")}),document.querySelectorAll(".cameraRow").forEach(e=>{e.style.zIndex="1"}))}function updateSelectedSpeakers(e,t,n){const a=t.getAttribute("data-speaker"),s=t.querySelector("span:last-child").textContent,o=e.querySelector(`[data-speaker-id="${a}"]`);if(n&&!o){const t=e.querySelector(".placeholder");t&&(t.innerHTML="");const n=document.createElement("div");n.className=`selectedSpeaker speaker-color-${a}`,n.setAttribute("data-speaker-id",a),n.innerHTML=`\n            ${s}\n            <button class="removeButton" onclick="event.stopPropagation(); removeSpeakerTag(this);">×</button>\n        `,e.appendChild(n)}else!n&&o&&(o.remove(),updateHeaderState(e))}function updateHeaderState(e){0===e.children.length&&(e.innerHTML='<span class="placeholder">Select speakers...</span>')}function getCombinations(e,t){const n=[],a=e.length;if(t>a||t<=0)return n;return function s(o,r){if(r.length!==t)for(let t=o;t<a;t++)r.push(e[t]),s(t+1,r),r.pop();else n.push([...r])}(0,[]),n}function intelligentSpeakerAssignment(){const e=parseInt(document.getElementById("speakerCount").value),t=document.querySelectorAll(".cameraRow");if(0===t.length||0===e)return;const n=Array.from({length:e},(e,t)=>t+1);let a=[];n.forEach(e=>a.push([e])),e>1&&a.push(n);for(let t=2;t<e;t++){const e=getCombinations(n,t);a.push(...e)}t.forEach((e,t)=>{const n=e.querySelector(".multiSelectHeader"),s=e.querySelector(".multiSelectDropdown");if(!n||!s)return;n.innerHTML='<span class="placeholder">Select speakers...</span>',s.querySelectorAll(".speakerOption.selected").forEach(e=>e.classList.remove("selected"));n.querySelectorAll(".selectedSpeaker").forEach(e=>e.remove()),updateHeaderState(n);const o=a[t];o&&o.forEach(e=>{const t=s.querySelector(`.speakerOption[data-speaker="${e}"]`);t&&(t.classList.add("selected"),updateSelectedSpeakers(n,t,!0))})})}function collectAllParameters(){const e={speakerCount:parseInt(document.getElementById("speakerCount").value),cameraCount:parseInt(document.getElementById("cameraCount").value),minCutTime:parseInt(document.getElementById("minCutTime").value)||0,maxCutTime:parseInt(document.getElementById("maxCutTime").value)||0,delayCuts:parseFloat(document.getElementById("delayCutsValue").value),ignoreCutLessThan:parseFloat(document.getElementById("ignoreCutValue").value),cuttingMethod:document.getElementById("cuttingMethod").value},t=[];document.querySelectorAll(".speakerRow").forEach(e=>{const n=e.querySelector(".speakerNameInput").dataset.speakerId,a=e.querySelector(".audioTrackSelect").value;t.push({name:`Speaker ${n}`,audioTrack:a})});const n=[];return document.querySelectorAll(".cameraRow").forEach(e=>{const t=e.querySelector(".cameraTitle").textContent,a=e.querySelector(".frequencySelect").value,s=Array.from(e.querySelectorAll(".selectedSpeaker")).map(e=>{const t=e.dataset.speakerId;return{id:t,name:`Speaker ${t}`}});n.push({videoTrack:t,frequency:a,selectedSpeakers:s})}),{global:e,speakers:t,cameras:n}}document.addEventListener("DOMContentLoaded",function(){initAuthEvents(),initAuth()}),window.auth={getAuthToken:getAuthToken,isUserLoggedIn:isUserLoggedIn,getUserData:()=>userData,hasRequiredMembership:hasRequiredMembership,updateUserCredits:updateUserCredits},document.getElementById("podcastButton").addEventListener("click",function(){this.classList.toggle("active");const e=document.getElementById("autoEditButton"),t=document.getElementById("imageGenerationButton"),n=document.getElementById("toolButton"),a=document.getElementById("podcastInterface");e.classList.contains("active")&&(e.classList.remove("active"),e.querySelector("img").src="assets/autoEdit.png"),t.classList.contains("active")&&(t.classList.remove("active"),t.querySelector("img").src="assets/atom.png"),n.classList.contains("active")&&(n.classList.remove("active"),n.querySelector("img").src="assets/edit.png");const s=document.getElementById("autoEditInterface"),o=document.getElementById("imageGenerationInterface"),r=document.getElementById("toolInterface"),i=document.getElementById("messageInput");s.style.display="none",o.style.display="none",r.style.display="none";const c=document.getElementById("sendButton");this.classList.contains("active")?(this.querySelector("img").src="assets/podcastBlue.png",a.style.display="flex",c.style.display="none",document.body.classList.add("panel-active"),i.placeholder="Podcast Editing",resetPodcastAnimations()):(this.querySelector("img").src="assets/podcast.png",a.style.display="none",messageContainer.style.display="flex",c.style.display="flex",document.body.classList.remove("panel-active"),i.placeholder="Message to Copilot")}),document.addEventListener("DOMContentLoaded",function(){initDynamicSections(),initSliders();const e=document.getElementById("minCutTime"),t=document.getElementById("maxCutTime");e&&t&&(e.addEventListener("change",validateCutTimes),t.addEventListener("change",validateCutTimes));const n=document.querySelector(".podcast_startEditing");n&&n.addEventListener("click",async function(){const e=collectAllParameters();console.log("Starting podcast editing with parameters:",e),await startPodcastEditing(e)})});const PRESET_STORAGE_KEY="podcast_presets";function getPresets(){const e=localStorage.getItem(PRESET_STORAGE_KEY);if(!e)return{};try{return JSON.parse(e)}catch(e){return console.error("Error parsing presets",e),{}}}function savePresets(e){localStorage.setItem(PRESET_STORAGE_KEY,JSON.stringify(e))}function populatePresetSelect(){const e=document.getElementById("presetSelect");if(!e)return;const t=e.value;e.innerHTML='<option value="">Select Preset</option>';const n=getPresets();Object.keys(n).forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}),t&&n[t]&&(e.value=t)}function handleSavePreset(){const e=prompt("Preset name?");if(!e)return;const t=getPresets();t[e]=collectAllParameters(),savePresets(t),populatePresetSelect(),document.getElementById("presetSelect").value=e,alert("Preset saved")}function handleDeletePreset(){const e=document.getElementById("presetSelect").value;if(!e)return;if(!confirm(`Delete preset "${e}"?`))return;const t=getPresets();delete t[e],savePresets(t),populatePresetSelect(),alert("Preset deleted")}function applyPreset(e){const t=getPresets()[e];t&&(document.getElementById("speakerCount").value=t.global.speakerCount,document.getElementById("cameraCount").value=t.global.cameraCount,document.getElementById("minCutTime").value=t.global.minCutTime||"",document.getElementById("maxCutTime").value=t.global.maxCutTime||"",document.getElementById("delayCutsValue").value=t.global.delayCuts,document.getElementById("ignoreCutValue").value=t.global.ignoreCutLessThan,document.getElementById("cuttingMethod").value=t.global.cuttingMethod,document.getElementById("delayCutsSlider").value=t.global.delayCuts,document.getElementById("ignoreCutSlider").value=t.global.ignoreCutLessThan,updateSpeakersSection(),updateCamerasSection(),t.speakers.forEach((e,t)=>{const n=document.querySelectorAll(".speakerRow")[t];if(!n)return;const a=n.querySelector(".speakerNameInput"),s=n.querySelector(".audioTrackSelect");a&&(a.value=e.name),s&&(s.value=e.audioTrack)}),t.cameras.forEach((e,t)=>{const n=document.querySelectorAll(".cameraRow")[t];if(!n)return;updateCameraSpeakerOptions(n);const a=n.querySelector(".multiSelectHeader"),s=n.querySelector(".multiSelectDropdown");s&&a&&e.selectedSpeakers.forEach(e=>{const t=s.querySelector(`.speakerOption[data-speaker="${e.id}"]`);t&&!t.classList.contains("selected")&&(t.classList.add("selected"),updateSelectedSpeakers(a,t,!0))})}),setupMultiSelectEvents(),updateSpeakerNamesInCameraSection())}function displayExtractedImage(e,t){const n=t.querySelector(".imageContainer"),a=t.querySelector(".deleteImageButton"),s=n.querySelector("img");s&&s.remove();const o=document.createElement("img");o.src=e,o.setAttribute("data-file-path",e),n.appendChild(o),n.style.setProperty("--bg-image",`url(${e})`),a.style.display="flex",t.classList.add("hasImage")}function getFrameBoxByDataFrame(e){const t=document.querySelectorAll(".frameIcon");for(const n of t)if(n.getAttribute("data-frame")===e)return n.closest(".frameBox");return null}function resetAnimations(){const e=document.querySelector("#autoEditInterface .autoEdit_boxWrapper:first-child"),t=document.querySelector("#autoEditInterface .autoEdit_boxWrapper:last-child"),n=document.querySelector("#autoEditInterface .documentation-section"),a=document.querySelectorAll("#autoEditInterface .autoEdit_inputGroup"),s=document.querySelectorAll("#autoEditInterface .documentation-item");e&&(e.style.animation="none"),t&&(t.style.animation="none"),n&&(n.style.animation="none"),a.forEach(e=>{e.style.animation="none"}),s.forEach(e=>{e.style.animation="none"}),e&&e.offsetWidth,t&&t.offsetWidth,n&&n.offsetWidth,a.forEach(e=>{e.offsetWidth}),s.forEach(e=>{e.offsetWidth}),e&&(e.style.animation="fadeInLeft 0.3s ease-out forwards"),t&&(t.style.animation="fadeInRight 0.3s ease-out forwards",t.style.animationDelay="0.1s"),n&&(n.style.animation="fadeInUp 0.3s ease-out forwards",n.style.animationDelay="0.2s"),a.forEach((e,t)=>{e.style.animation="fadeInScale 0.25s ease-out forwards",e.style.animationDelay=.25+.05*t+"s"}),s.forEach((e,t)=>{e.style.animation="fadeInLeft 0.25s ease-out forwards",e.style.animationDelay=.35+.05*t+"s"})}function showSuggestions(e,t,n){const a=e.value.toLowerCase(),s=t.filter(e=>e.toLowerCase().includes(a)).slice(0,3);if(n.innerHTML="",s.length>0&&a.length>0){e.closest(".autoEdit_inputBox");s.forEach(t=>{const a=document.createElement("div");a.className="suggestionItem",a.textContent=t,a.addEventListener("click",()=>{e.value=t,n.classList.remove("show")}),n.appendChild(a)}),n.classList.add("show")}else n.classList.remove("show")}function resetToolAnimations(){const e=[document.getElementById("jumpCutSliders1"),document.getElementById("jumpCutSliders2"),document.getElementById("jumpCutPreviewArea"),document.getElementById("jumpCutButtons")];e.forEach(e=>{e&&(e.style.animation="none",e.style.opacity="0",e.offsetWidth)}),e[0]&&(e[0].style.animation="fadeInUp 0.4s ease-out forwards",e[0].style.animationDelay="0.1s"),e[1]&&(e[1].style.animation="fadeInUp 0.4s ease-out forwards",e[1].style.animationDelay="0.2s"),e[2]&&(e[2].style.animation="fadeInUp 0.4s ease-out forwards",e[2].style.animationDelay="0.3s"),e[3]&&(e[3].style.animation="fadeInUp 0.4s ease-out forwards",e[3].style.animationDelay="0.4s")}function launchApp(){const{exec:e}=require("child_process"),t=require("path"),n=window.__adobe_cep__.getSystemPath("extension");let a;if(0===window.cep.fs.readdir("C:\\").err){const e=decodeURI(n.replace("file:///",""));a=`"${t.join(e,"js","libs","PremiereCopilotAPI","PremiereCopilot.exe")}"`}else{a=`"${decodeURI(n.replace("file://",""))}/js/libs/PremiereCopilotAPI/PremiereCopilot"`}e(a,(e,t,n)=>{});const s=document.getElementById("sendButton");s.style.display="none",function e(){updateStatusMessage("Starting Copilot"),fetch("http://127.0.0.1:8000/hello").then(t=>{t.ok?(updateStatusMessage("End"),s.style.display="flex"):setTimeout(e,1e3)}).catch(()=>{setTimeout(e,1e3)})}()}function displayAppMessage(e,t=!1){const n=document.createElement("div");n.className="appMessageContainer";const a=document.createElement("div");if(a.className="appMessage",n.appendChild(a),t){const e=document.createElement("div");e.className="appMessageBox",n.appendChild(e)}document.getElementById("messageContainer").appendChild(n);const s=e.split(" ");let o=0;!function e(){if(o<s.length){const t=document.createElement("span");t.style.opacity="0",t.style.transition="opacity 0.3s ease-in",t.textContent=s[o],o>0&&a.appendChild(document.createTextNode(" ")),a.appendChild(t),scrollToBottom(),setTimeout(()=>{t.style.opacity="1"},10),o++,setTimeout(e,30)}}()}function generateUniqueId(){return`msg_${Date.now()}_${Math.random().toString(36).substring(2,10)}`}function displayUserMessage(e,t){const n=document.createElement("div");n.className="userMessage",n.textContent=e,n.dataset.messageId=t,n.addEventListener("contextmenu",function(e){e.preventDefault();const t=this.textContent,n=document.getElementById("messageInput");n.value=t,adjustTextareaHeight(),n.focus()});const a=document.createElement("div");a.className="userMessageContainer",a.appendChild(n);document.getElementById("messageContainer").appendChild(a),scrollToBottom()}function scrollToBottom(){const e=document.getElementById("messageContainer");e&&(e.scrollTop=e.scrollHeight)}function hideSuggestions(){const e=document.getElementById("suggestionsContainer"),t=document.getElementById("back_text");e&&(e.style.display="none",t.style.display="none")}function resetChatBoxHeight(){const e=document.getElementById("chatBox"),t=document.getElementById("messageInput");t.style.height="auto";let n=t.scrollHeight;t.style.height=n+"px";let a=n+38;e.style.height=Math.max(78,a)+"px"}document.addEventListener("DOMContentLoaded",()=>{populatePresetSelect();const e=document.querySelector(".small-action-button.save"),t=document.querySelector(".small-action-button:not(.save)"),n=document.getElementById("presetSelect");e&&e.addEventListener("click",handleSavePreset),t&&t.addEventListener("click",handleDeletePreset),n&&n.addEventListener("change",e=>{e.target.value&&applyPreset(e.target.value)})}),document.getElementById("imageGenerationButton").addEventListener("click",function(){this.classList.toggle("active");const e=this.classList.contains("active"),t={podcast:{button:document.getElementById("podcastButton"),interface:document.getElementById("podcastInterface"),icon:"podcast.png"},autoEdit:{button:document.getElementById("autoEditButton"),interface:document.getElementById("autoEditInterface"),icon:"autoEdit.png"},tool:{button:document.getElementById("toolButton"),interface:document.getElementById("toolInterface"),icon:"edit.png"},imageGeneration:{interface:document.getElementById("imageGenerationInterface")}},n={img:this.querySelector("img"),messageInput:document.getElementById("messageInput"),sendButton:document.getElementById("sendButton"),messageContainer:document.getElementById("messageContainer")};for(const e in t)"imageGeneration"!==e&&t[e].button&&(t[e].button.classList.remove("active"),t[e].button.querySelector("img").src=`assets/${t[e].icon}`),t[e].interface&&(t[e].interface.style.display="none");e?(n.img.src="assets/atomBlue.png",t.imageGeneration.interface.style.display="flex",document.body.classList.add("panel-active"),n.messageContainer.style.display="none",n.messageInput.placeholder="Describe your image...",n.sendButton.style.display="none"):(n.img.src="assets/atom.png",t.imageGeneration.interface.style.display="none",document.body.classList.remove("panel-active"),n.messageContainer.style.display="flex",n.messageInput.placeholder="Message to Copilot",n.sendButton.style.display="flex")}),document.querySelectorAll('.frameIcon[src="assets/uploadImage.png"]').forEach(e=>{e.addEventListener("click",async function(){try{const e=await runExtendScript("$._MYFUNCTIONS.openFinderAndGetPath()");if("undefined"===e)return;const t=e.toLowerCase().split(".").pop();if("jpg"!==t&&"jpeg"!==t&&"png"!==t)return void alert("Select an JPG or PNG, less than 10mb, more than 300px");displayExtractedImage(e,this.closest(".frameBox"))}catch(e){console.error("Error getting file path:",e)}})}),document.querySelectorAll(".deleteImageButton").forEach(e=>{e.addEventListener("click",function(){const e=this.closest(".frameBox"),t=e.querySelector(".imageContainer"),n=t.querySelector("img");n&&(URL.revokeObjectURL(n.src),n.remove(),t.style.setProperty("--bg-image","none"),this.style.display="none",e.classList.remove("hasImage"))})}),document.querySelectorAll('.frameIcon[src="assets/extract.png"]').forEach(e=>{e.addEventListener("click",async function(){const e=this.closest(".frameBox");displayExtractedImage(await runExtendScript("$._MYFUNCTIONS.exportCurrentFrameToTempPNG()"),e)})}),document.querySelector(".generateImage").addEventListener("click",async function(){const e=this;updateStatusMessage("Generating Image");const t=document.getElementById("messageInput").value.trim(),n=getFrameBoxByDataFrame("start");let a=null;if(n){const e=n.querySelector(".imageContainer img");e&&(a=e.getAttribute("data-file-path"))}if(!t)return void alert("Veuillez décrire votre image dans la zone de message");e.disabled=!0,e.style.opacity=.5;const s=n.querySelector(".deleteImageButton");s&&s.click();try{const e=document.getElementById("aspectRatioSelect").value,s=await generateImage(t,a,e);s&&(displayExtractedImage(s,n),window.auth&&"function"==typeof window.auth.updateUserCredits&&window.auth.updateUserCredits())}catch(e){alert("Erreur lors de la génération : "+e.message)}finally{e.disabled=!1,e.style.opacity=1,updateStatusMessage("End")}}),document.querySelector(".generateVideo").addEventListener("click",async function(){const e=this;updateStatusMessage("Collecting Informations");const t=getFrameBoxByDataFrame("start"),n=t?.querySelector(".imageContainer img")?.getAttribute("data-file-path"),a={aspectRatio:document.getElementById("aspectRatioSelect").value,type:document.getElementById("typeSelect").value,prompt:document.getElementById("messageInput").value};if(!a.prompt.trim())return alert("Veuillez décrire votre vidéo dans la zone de message"),void updateStatusMessage("End");if(!n)return alert("Veuillez ajouter une image de départ"),void updateStatusMessage("End");const s={startFramePath:n,...a};e.disabled=!0,e.style.opacity=.5;const o=t.querySelector(".deleteImageButton");o&&o.click();try{const e=await generateVideo(s);runExtendScript("$._MYFUNCTIONS.importVideoToVideoGenerationBin("+JSON.stringify(e)+")"),window.auth&&"function"==typeof window.auth.updateUserCredits&&window.auth.updateUserCredits()}catch(e){alert("Erreur lors de la génération de la vidéo : "+e.message)}finally{e.disabled=!1,e.style.opacity=1}}),document.querySelector(".generativeFill").addEventListener("click",async function(){if(document.getElementById("messageInput").value.trim()){updateStatusMessage("Génération en cours (Generative Fill)");try{await autoFill(),window.auth&&"function"==typeof window.auth.updateUserCredits&&window.auth.updateUserCredits()}catch(e){alert("Erreur lors du Generative Fill : "+e.message)}}else alert("Please add a prompt to describe your creative intention")}),document.getElementById("autoEditButton").addEventListener("click",function(){this.classList.toggle("active");const e=document.getElementById("podcastButton"),t=document.getElementById("imageGenerationButton"),n=document.getElementById("toolButton"),a=document.getElementById("autoEditInterface");e.classList.contains("active")&&(e.classList.remove("active"),e.querySelector("img").src="assets/podcast.png"),t.classList.contains("active")&&(t.classList.remove("active"),t.querySelector("img").src="assets/atom.png"),n.classList.contains("active")&&(n.classList.remove("active"),n.querySelector("img").src="assets/edit.png");const s=document.getElementById("imageGenerationInterface"),o=document.getElementById("podcastInterface"),r=document.getElementById("toolInterface"),i=document.getElementById("messageInput");s.style.display="none",o.style.display="none",r.style.display="none";const c=document.getElementById("sendButton");this.classList.contains("active")?(this.querySelector("img").src="assets/autoEditBlue.png",a.style.display="flex",c.style.display="none",document.body.classList.add("panel-active"),i.placeholder="Auto Edit Mode...",resetAnimations()):(this.querySelector("img").src="assets/autoEdit.png",a.style.display="none",messageContainer.style.display="flex",c.style.display="flex",document.body.classList.remove("panel-active"),i.placeholder="Message to Copilot")}),document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("folderName"),t=document.getElementById("folderSuggestions");var n=await runExtendScript("$._MYFUNCTIONS.getAllBins()");(n=JSON.parse(n))&&n.length>0&&(e.value=n[0]),e.addEventListener("input",async()=>{showSuggestions(e,n,t)}),e.addEventListener("focus",async()=>{e.value.length>0&&showSuggestions(e,n,t)}),document.addEventListener("click",n=>{e.contains(n.target)||t.contains(n.target)||t.classList.remove("show")})}),document.getElementById("audioAnalysis").addEventListener("click",async function(){await audio_analysis()}),document.getElementById("fastEdit").addEventListener("click",async function(){await fast_edit()}),document.getElementById("autoEdit").addEventListener("click",async function(){await auto_edit()}),document.getElementById("toolButton").addEventListener("click",function(){this.classList.toggle("active");const e=document.getElementById("podcastButton"),t=document.getElementById("imageGenerationButton"),n=document.getElementById("autoEditButton"),a=document.getElementById("toolInterface");e.classList.contains("active")&&(e.classList.remove("active"),e.querySelector("img").src="assets/podcast.png"),t.classList.contains("active")&&(t.classList.remove("active"),t.querySelector("img").src="assets/atom.png"),n.classList.contains("active")&&(n.classList.remove("active"),n.querySelector("img").src="assets/autoEdit.png"),document.getElementById("podcastInterface").style.display="none",document.getElementById("imageGenerationInterface").style.display="none",document.getElementById("autoEditInterface").style.display="none";const s=document.getElementById("messageInput"),o=document.getElementById("sendButton");this.classList.contains("active")?(this.querySelector("img").src="assets/editBlue.png",a.style.display="flex",o.style.display="none",document.body.classList.add("panel-active"),s.placeholder="Tools",resetToolAnimations()):(this.querySelector("img").src="assets/edit.png",a.style.display="none",o.style.display="flex",document.body.classList.remove("panel-active"),s.placeholder="Message to Copilot")}),document.addEventListener("DOMContentLoaded",function(){function e(e,t){const n=document.getElementById(e),a=document.getElementById(t);n&&a&&(n.addEventListener("input",()=>{let t=parseFloat(n.value);a.value="removeSilencesSlider"===e||"keepSegmentsSlider"===e||"paddingSlider"===e?t.toFixed(1):t}),a.addEventListener("change",()=>{let t=parseFloat(a.value);const s=parseFloat(n.min),o=parseFloat(n.max);isNaN(t)&&(t=s),t<s&&(t=s),t>o&&(t=o),a.value="removeSilencesSlider"===e||"keepSegmentsSlider"===e||"paddingSlider"===e?t.toFixed(1):t,n.value=t}),document.querySelectorAll(`.stepper-button[data-for="${t}"]`).forEach(t=>{t.addEventListener("click",()=>{const s=parseFloat(t.dataset.step);let o=parseFloat(a.value);o+=s;const r=parseFloat(n.min),i=parseFloat(n.max);o<r&&(o=r),o>i&&(o=i),a.value="removeSilencesSlider"===e||"keepSegmentsSlider"===e||"paddingSlider"===e?o.toFixed(1):o,n.value=o})}))}e("silenceCutoffSlider","silenceCutoffValue"),e("removeSilencesSlider","removeSilencesValue"),e("keepSegmentsSlider","keepSegmentsValue"),e("paddingSlider","paddingValue");const t=document.getElementById("jumpCutPreview");t&&t.addEventListener("click",async()=>{const e={silenceCutoff:parseFloat(document.getElementById("silenceCutoffValue").value),removeSilencesOver:parseFloat(document.getElementById("removeSilencesValue").value),keepSegmentsOver:parseFloat(document.getElementById("keepSegmentsValue").value),padding:parseFloat(document.getElementById("paddingValue").value)},t=document.getElementById("jumpCutPreviewArea");t.innerHTML='<span class="preview-area-text">Generating preview...</span>';const n=await getJumpCutPreview(e);if(n&&n.preview_image_path){sessionStorage.setItem("jumpCutTimeSegments",JSON.stringify(n.time_segments));const e=document.createElement("img");e.src="file:///"+n.preview_image_path+"?t="+(new Date).getTime(),e.style.width="100%",e.style.height="100%",e.style.objectFit="contain",t.innerHTML="",t.appendChild(e)}else{const e=n?n.error||JSON.stringify(n):"An unknown error occurred.";alert(e),t.innerHTML='<span class="preview-area-text">Error generating preview.</span>'}});const n=document.getElementById("createJumpCuts");n&&n.addEventListener("click",async()=>{const e={silenceCutoff:parseFloat(document.getElementById("silenceCutoffValue").value),removeSilencesOver:parseFloat(document.getElementById("removeSilencesValue").value),keepSegmentsOver:parseFloat(document.getElementById("keepSegmentsValue").value),padding:parseFloat(document.getElementById("paddingValue").value)},t=(document.getElementById("jumpCutPreviewArea"),await createJumpCutsAnalysis(e));if(t&&t.length>0)try{updateStatusMessage("Performing cuts"),await runExtendScript(`$._MYFUNCTIONS.disableSegmentsInRange('${JSON.stringify(t)}')`),updateStatusMessage("End")}catch(e){updateStatusMessage("End"),alert(`Error creating jump cuts: ${e}`)}else updateStatusMessage("End"),alert("No segments to cut were found after analysis.")});const a=document.getElementById("deleteDisabledClips");a&&a.addEventListener("click",async()=>{try{updateStatusMessage("Backup"),await runExtendScript("$._MYFUNCTIONS.backupActiveSequence()"),updateStatusMessage("Deleting disabled clips"),await runExtendScript("$._MYFUNCTIONS.supprimerClipsDesactives_PODCAST()"),await runExtendScript("$._MYFUNCTIONS.supprimerClipsDesactives()"),updateStatusMessage("End")}catch(e){updateStatusMessage("End"),alert(`Error deleting disabled clips: ${e}`)}})}),launchApp(),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("messageInput"),t=document.getElementById("sendButton"),n=document.getElementById("loadingIndicator"),a=document.getElementById("statusMessage"),s=document.getElementById("imageGenerationButton"),o=document.getElementById("podcastButton"),r=document.getElementById("autoEditButton"),i=document.getElementById("toolButton");e.addEventListener("keydown",function(a){if("Enter"===a.key){if(s.classList.contains("active"))return void a.preventDefault();if(o.classList.contains("active"))return void a.preventDefault();if(r.classList.contains("active"))return void a.preventDefault();if(i.classList.contains("active"))return void a.preventDefault();if(a.metaKey||a.ctrlKey||a.shiftKey){const t=e.selectionStart;e.value=e.value.slice(0,t)+"\n"+e.value.slice(t),e.selectionStart=e.selectionEnd=t+1,a.preventDefault()}else{"none"!==window.getComputedStyle(n).display||(a.preventDefault(),t.click())}}}),t.addEventListener("click",function(){!async function(){const s=e.value.trim();if(!s)return;const o=generateUniqueId();t.style.display="none",n.style.display="flex",a.style.display="block",a.textContent="Analyzing....",displayUserMessage(s,o),e.value="",resetChatBoxHeight(),displayAppMessage(await Pipeline(s,o)),t.style.display="flex",a.style.display="none",n.style.display="none"}()})}),document.querySelectorAll(".suggestionBox").forEach(e=>{e.addEventListener("click",function(){const e=this.querySelector("h3").textContent,t=generateUniqueId();document.getElementById("suggestionsContainer").style.display="none",document.getElementById("back_text").style.display="none",displayUserMessage(e,t),Pipeline(e,t).then(e=>{displayAppMessage(e)})})}),document.getElementById("plusButton").addEventListener("click",function(){const e=document.getElementById("messageContainer"),t=document.getElementById("suggestionsContainer"),n=document.getElementById("back_text");e.innerHTML="",t.style.display="grid",t.style.gridTemplateColumns="1fr 1fr",t.style.gap="10px",t.style.width="80%",t.style.maxWidth="500px",t.style.textAlign="center",n.style.display="block"}),document.getElementById("sendButton").addEventListener("click",function(){hideSuggestions()}),document.getElementById("messageInput").addEventListener("keydown",function(e){"Enter"!==e.key||e.shiftKey||hideSuggestions()}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("messageInput"),t=document.getElementById("chatBox");function n(){e.style.height="auto";let n=e.scrollHeight,a=Math.min(n,200);e.style.height=a+"px",e.style.overflowY=n>200?"auto":"hidden";let s=a+38;t.style.height=Math.max(78,s)+"px"}e.addEventListener("input",n),document.getElementById("messageContainer").addEventListener("contextmenu",function(t){if(t.target.classList.contains("userMessage")){t.preventDefault();const a=t.target.textContent;e.value=a,n(),e.focus()}})}),document.querySelectorAll(".suggestionBox").forEach(e=>{e.addEventListener("mouseenter",function(e){let t=this.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,s=n/t.width*100,o=a/t.height*100;this.style.setProperty("--cursorX",s+"%"),this.style.setProperty("--cursorY",o+"%")})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("messageSaveModal"),t=document.getElementById("messageToSave"),n=document.getElementById("saveName"),a=document.getElementById("cancelSaveButton"),s=document.getElementById("confirmSaveButton"),o=document.getElementById("messageContainer");let r="",i="";function c(){e.classList.remove("active"),r="",i=""}function l(){document.querySelectorAll(".userMessageContainer").forEach(a=>{a.hasAttribute("data-listener")||(a.setAttribute("data-listener","true"),a.addEventListener("click",function(){const a=this.querySelector(".userMessage"),s=a.textContent,o=a.dataset.messageId;o?function(a,s){r=s,i=a,t.textContent=a,e.classList.add("active"),n.value="",n.focus()}(s,o):console.error("Message sans ID, impossible de sauvegarder")}))})}function u(e,t="success"){const n=document.createElement("div");n.className=`notification ${t}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>n.classList.add("visible"),10),setTimeout(()=>{n.classList.remove("visible"),setTimeout(()=>n.remove(),300)},3e3)}new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.length&&l()})}).observe(o,{childList:!0}),l(),a.addEventListener("click",c),e.addEventListener("click",function(e){e.target.closest(".messageSaveModalContent")||c()}),s.addEventListener("click",async function(){const e=n.value.trim();if(!e)return n.classList.add("error"),void setTimeout(()=>{n.classList.remove("error")},500);if(!await async function(e){try{const t=await fetch("http://127.0.0.1:8000/get-saved-scripts");if(!t.ok)throw new Error("Erreur lors de la récupération des scripts sauvegardés");return!(await t.json()).some(t=>t.name===e)}catch(e){return console.error("Erreur lors de la vérification de l'unicité du nom:",e),!0}}(e))return alert("A task with this name already exists. Please choose another name."),void n.focus();!async function(e,t){try{const n=await fetch("http://127.0.0.1:8000/save-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_prompt:e,script_name:t})}),a=await n.json();"success"===a.status?(u("Task saved successfully!"),document.getElementById("scriptInterface").classList.contains("active")&&loadSavedScripts()):u("Error: "+a.message,"error")}catch(e){console.error("Erreur lors de la sauvegarde du script:",e),u("Error: "+e,"error")}}(r,e),c()}),n.addEventListener("keydown",function(e){"Enter"===e.key?s.click():"Escape"===e.key&&c()})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("scriptButton"),t=document.getElementById("scriptInterface"),n=document.getElementById("scriptsGrid"),a=document.getElementById("chatInterface"),s=document.getElementById("messageContainer"),o=document.getElementById("topIcons"),r=document.getElementById("scriptSearchContainer"),i=document.getElementById("scriptSearch"),c=document.getElementById("clearSearch");let l=[];function u(t){const n=e.querySelector("img");n.src=t?"assets/scriptBlue.png":"assets/script.png"}async function d(){try{n.innerHTML='\n                <div class="scriptLoading">\n                    <p>Loading scripts...</p>\n                </div>\n            ';const e=await fetch("http://127.0.0.1:8000/get-saved-scripts");if(!e.ok)throw new Error("Erreur lors de la récupération des scripts sauvegardés");const t=await e.json();l=t,p(t)}catch(e){console.error("Erreur lors du chargement des scripts:",e),n.innerHTML='\n                <div class="scriptError">\n                    <p>An error occurred while loading the scripts.</p>\n                    <button id="retryButton" class="retryButton">Retry</button>\n                </div>\n            ';const t=document.getElementById("retryButton");t&&t.addEventListener("click",d)}}function p(e){n.innerHTML="",0!==e.length?e.forEach(t=>{const a=document.createElement("div");a.className="scriptCard",a.setAttribute("data-script-id",t.id_prompt);const s=document.createElement("div");s.className="scriptName",s.textContent=t.name,a.appendChild(s),a.addEventListener("mouseenter",function(){this.style.transform="translateY(-3px)",this.style.boxShadow="0 8px 20px rgba(0, 0, 0, 0.3)"}),a.addEventListener("mouseleave",function(){this.style.transform="translateY(0)",this.style.boxShadow="0 5px 15px rgba(0, 0, 0, 0.2)"}),a.addEventListener("click",async function(){this.style.transform="scale(0.97)",setTimeout(()=>{this.style.transform="translateY(-3px)"},150);const e=this.getAttribute("data-script-id");console.log("Exécution du script:",t.name,"avec l'ID:",e),await async function(e){try{const t=await fetch("http://127.0.0.1:8000/execute-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_prompt:e})});if(!t.ok)throw new Error("Erreur lors de l'exécution du script");const n=await t.json();if(!n.code)return console.error("Aucun code reçu du serveur"),!1;runRawExtendScriptCode(n.code)}catch(e){return console.error("Erreur lors de l'exécution du script:",e),!1}}(e),function(e,t="success"){const n=document.createElement("div");n.className=`notification ${t}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>n.classList.add("visible"),10),setTimeout(()=>{n.classList.remove("visible"),setTimeout(()=>n.remove(),300)},3e3)}("Task executed successfully!")}),n.appendChild(a),a.style.opacity="0",a.style.transform="translateY(20px)",setTimeout(()=>{a.style.transition="all 0.3s ease",a.style.opacity="1",a.style.transform="translateY(0)"},50*e.indexOf(t))}):n.innerHTML='\n                <div class="scriptError">\n                    <p>No task saved</p>\n                </div>\n            '}function m(e){if(!e)return void p(l);p(l.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())))}e.addEventListener("click",function(){if(t.classList.contains("active"))t.classList.remove("active"),e.classList.remove("active"),r.classList.remove("active"),u(!1),s&&(s.style.display="flex"),setTimeout(()=>{document.querySelectorAll("#chatInterface > div:not(#topIcons):not(#scriptInterface)").forEach(e=>{e.style.display=""})},300);else{e.classList.add("active"),r.classList.add("active"),u(!0),setTimeout(()=>{i.focus()},300);document.querySelectorAll("#chatInterface > div:not(#topIcons):not(#scriptInterface)").forEach(e=>{e.style.display="none"}),o&&(o.style.display="flex"),t.classList.add("active"),a.style.display="flex",d()}}),t.addEventListener("click",function(e){e.stopPropagation()}),i.addEventListener("input",function(){m(this.value)}),c.addEventListener("click",function(){i.value="",m(""),i.focus()}),r.addEventListener("click",function(e){e.stopPropagation()}),window.loadSavedScripts=d});